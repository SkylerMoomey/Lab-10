---
title: "Lab 10"
author: "Skyler Moomey"
date: "`r Sys.Date()`"
output: 
  html_document:
    df_print: paged
    fig_caption: true
    highlights: pygments
    number_sections: no
    theme: spacelab
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Tasks

## Task 1

### Working Directory

```{r}
getwd()
```

## Task 2

### mymaxlik()

Line A creates a new matrix, called $z$, which performs the binary operation denoted by lfun using the $i^{th}$ term of $x$ as the first operand and the $j^{th}$ term of param as the second. Thus, the $i,j$ index of $z$ is equal to $x$[i] lfun param[j].

Line B sets $i$ equal to the largest index of the column sums of $z$ where the maximum column sum was found.

### Maximum Likelihood of 8 Binomial Experiments, n=20

$$
\begin{equation*}
  \begin{split}
  L &= P(y_1)...P(y_8)\\
    &=\left ( {20 \choose y_1}p^{y_1}q^{20-y_1} \right)...\left ( {20 \choose y_8}p^{y_8}q^{20-y_8} \right)\\
    &={20 \choose y_1}...{20 \choose y_8}p^{y_1+...+y_8}q^{20 - y_1-...-y_8}\\
    &= \prod_{i=1}^{n}{20 \choose y_i}p^{y_i}(1-p)^{20-y_i}
  \end{split}
\end{equation*}
$$

### R function for this

```{r, eval=FALSE}
dbinom(y1,  20, prob)*dbinom(y2, 20, prob)*dbinom(y3, 20, prob)*dbinom(y4, 20,   prob)*dbinom(y5, 20,  prob)*dbinom(y6, 20, prob)*dbinom(y7, 20,  prob)*dbinom(y8, 20, prob)
```

### Plot

```{r}
mymaxlik=function(lfun,x,param,...){
# how many param values are there?
np=length(param)
# outer -- notice the order, x then param
# this produces a matrix -- try outer(1:4,5:10,function(x,y) paste(x,y,sep=" "))   to understand
z=outer(x,param,lfun)
# z is a matrix where each x,param is replaced with the function evaluated at those values
y=apply(z,2,sum)

# y is a vector made up of the column sums
# Each y is the log lik for a new parameter value
plot(param,y,col="Blue",type="l",lwd=2,...)
# which gives the index for the value of y == max.
# there could be a max between two values of the parameter, therefore 2 indices
# the first max will take the larger indice
i=max(which(y==max(y)))
abline(v=param[i],lwd=2,col="Red")

# plots a nice point where the max lik is
points(param[i],y[i],pch=19,cex=1.5,col="Black")
axis(3,param[i],round(param[i],2))
#check slopes. If it is a max the slope shoud change sign from + to 
# We should get three + and two -vs
ifelse(i-3>=1 & i+2<=np, slope<-(y[(i-2):(i+2)]-y[(i-3):(i+1)])/(param[(i-2):(i+2)]-param[(i-3):(i+1)]),slope<-"NA")
return(list(i=i,parami=param[i],yi=y[i],slope=slope))
}
logbin=function(x,param) log(dbinom(x,prob=param,size=10))
mymaxlik(x=c(3,3,4,3,4,5,5,4), param=seq(0,1, length=1000), lfun="logbin", xlab="probability",main="Binomial",cex.main=2)
```

## Task 3

### Maximum likelihood for Poisson

```{r}
logpoiss=function(x,param) log(dpois(x,lambda=param)) 
mymaxlik(x=c(4,6,7,6,5),param=seq(0,20,length=1000),lfun=logpoiss,xlab=expression(lambda),main="Poisson",cex.main=2)
```

The estimated maximum likelihood of a Poisson distribution with random sample $(4,6,7,6,5)$ for $\lambda$ is $5.61$.

For a Poisson distribution with independent random sample $(4,6,7,6,5)$, the algebraic expression of the likelihood is:

$$
\begin{equation*}
  \begin{split}
  L &= p(4,6,7,6,5)\\
    &=p(4)p(6)p(7)p(6)p(5)\\
    &= \frac{e^{-\lambda} \lambda^{4}}{4!}*\frac{e^{-\lambda} \lambda^{6}}{6!}*\frac{e^{-\lambda} \lambda^{7}}{7!}*\frac{e^{-\lambda} \lambda^{6}}{6!}*\frac{e^{-\lambda} \lambda^{5}}{5!}
  \end{split}
\end{equation*}
$$

### myNRML()

```{r}
myNRML=function(x0,delta=0.001,llik,xrange,parameter="param"){
f=function(x) (llik(x+delta)-llik(x))/delta
fdash=function(x) (f(x+delta)-f(x))/delta
d=1000
i=0
x=c()
y=c()
x[1]=x0
y[1]=f(x[1])
while(d > delta & i<100){
i=i+1
x[i+1]=x[i]-f(x[i])/fdash(x[i])
y[i+1]=f(x[i+1])
d=abs(y[i+1])
}
layout(matrix(1:2,nr=1,nc=2,byrow=TRUE),width=c(1,2))
curve(llik(x), xlim=xrange,xlab=parameter,ylab="log Lik",main="Log Lik")
curve(f(x),xlim=xrange,xaxt="n", xlab=parameter,ylab="derivative",main=  "Newton-Raphson Algorithm \n on the derivative")
points(x,y,col="Red",pch=19,cex=1.5)
axis(1,x,round(x,2),las=2)
abline(h=0,col="Red")

segments(x[1:(i-1)],y[1:(i-1)],x[2:i],rep(0,i-1),col="Blue",lwd=2)
segments(x[2:i],rep(0,i-1),x[2:i],y[2:i],lwd=0.5,col="Green")

list(x=x,y=y)
}
```


```{r}
x <- c(4,6,7,6,5)

myNRML(x0=1,delta=0.000001,llik=function(x) log(dpois(12,x)*dpois(10,x)),xrange=c(0,20),parameter="lambda" )
```
The Newton Raphson estimates that $\hat \lambda=10.5$.

## Task 4

### mymaxlikg()

```{r}
logbin2=function(theta){log(dbinom(2,prob=theta,size=6)) + log(dbinom(4,prob=theta,size=10))}

mymaxlikg=function(lfun="logbin2",theta) { # default log lik is a combination bin
nth=length(theta)  # nu. of valuse used in theta
thmat=matrix(theta,nr=nth,nc=1,byrow=TRUE) # Matrix of theta
z=apply(thmat,1,lfun) # z holds the log lik values
zmax=max(which(z==max(z)))  # finding the INDEX of the max lik
plot(theta,exp(z),type="l") # plot of lik
abline(v=theta[zmax],col="Blue")   #  verical line through max
axis(3,theta[zmax],round(theta[zmax],4))  # one tick on the third axis 
theta[zmax]   # theta corresponding to max lik
}
```

```{r}
mymaxlikg(theta=seq(0,1,length=10000))
```
By the Maximum Likelihood Estimate, for two binomial experiments with equivalent probability of success $p$ and with $N_1=6, n_1=2$ and $N_2=10, n_2=4$, that $\hat p=0.375$.
